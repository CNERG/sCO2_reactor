from mcnp_inputs import HomogeneousInput, build_pyne_matlib

def test_homog_comp():
    """Test fuel, clad, coolant homogenization process.
    """
    exp_comp = {
        5010 : 4.36075073231383E-07,
        5011 : 1.92993563688806E-06,
        6012 : 0.0010947754,
        6013 : 1.2830888245035E-05,
        8016 : 0.0028588528,
        7015 : 0.0277709767,
        13027 : 0.0002365987,
        14028 : 0.0001382399, 
        14029 : 7.2735173898753E-06,
        14030 : 4.96573362106248E-06,
        15031 : 6.62476374069704E-06,
        16032 : 6.27459765726019E-06,
        16033 : 5.10911243630757E-08,
        16034 : 2.98261059528482E-07,
        16036 : 7.43109212742188E-10,
        22046 : 0.00003373,
        22047 : 3.10796058920701E-05,
        22048 : 0.0003144917,
        22049 : 2.3560499046379E-05,
        22050 : 2.30182148144619E-05,
        24050 : 0.0003752455,
        24052 : 0.0075252584,
        24053 : 0.0008697368,
        24054 : 0.0002205762,
        25055 : 0.0001504768,
        26054 : 0.0004541465,
        26056 : 0.0073927631,
        26057 : 0.0001737865,
        26058 : 2.35335267940061E-05,
        27059 : 0.0004306096,
        28058 : 0.0166939314,
        28060 : 0.006651736,
        28061 : 0.0002939786,
        28062 : 0.0009526883,
        28064 : 0.0002504255,
        29063 : 8.84642558088079E-05,
        29065 : 4.07195835296044E-05,
        41093 : 0.0024251367,
        42092 : 0.0002008486,
        42094 : 0.0001292302,
        42095 : 0.0002260985,
        42096 : 0.0002404505,
        42097 : 0.0001399197,
        42098 : 0.0003591474,
        42100 : 0.0001475571,
        74180 : 0.0005276074,
        74182 : 0.1178065703,
        74183 : 0.0639677953,
        74184 : 0.1377097583,
        74186 : 0.129170837,
        92235 : 0.4246171846,
        92238 : 0.0471796872
               }

    # build example input file
    matlib = build_pyne_matlib()
    obs = HomogeneousInput(15, 0.6, 15)
    comp = obs.homog_core(matlib)
    obs_str = obs.fuel_string.split('\n')
    print(obs.fuel_string)
    
    # extract compositions from string
    for line in obs_str:
        if 'm' not in line and line != '':
            data = list(filter(None, line.split(' ')))
            print(data)
            assert abs(exp_comp[float(data[0])] - -float(data[1])) < 1e-5
